<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ruckig: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ruckig
   &#160;<span id="projectnumber">0.3.3</span>
   </div>
   <div id="projectbrief">Online Trajectory Generation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ruckig Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="center"> <h1 align="center">Ruckig</h1>
</div><div align="center"> <h3 align="center">Online Trajectory Generation. Real-time. Time-optimal. Jerk-constrained. </h3>
</div><div align="center"> </div> <p><a href="https://github.com/pantor/ruckig/actions"><object type="image/svg+xml" data="https://github.com/pantor/ruckig/workflows/CI/badge.svg" style="pointer-events: none;">CI</object> </a></p>
<p><a href="https://github.com/pantor/ruckig/issues"><object type="image/svg+xml" data="https://img.shields.io/github/issues/pantor/ruckig.svg" style="pointer-events: none;">Issues</object> </a></p>
<p><a href="https://github.com/pantor/ruckig/releases"><object type="image/svg+xml" data="https://img.shields.io/github/v/release/pantor/ruckig.svg?include_prereleases&amp;sort=semver" style="pointer-events: none;">Releases</object> </a></p>
<p><a href="https://github.com/pantor/ruckig/blob/master/LICENSE"><object type="image/svg+xml" data="https://img.shields.io/badge/license-MIT-green.svg" style="pointer-events: none;">LGPL</object> </a> </p>
<p>Ruckig calculates a time-optimal trajectory to a <em>target</em> waypoint with position, velocity, and acceleration starting from <em>any</em> initial state limited by velocity, acceleration, and jerk constraints. Ruckig is a more powerful and open-source alternative to the <a href="http://reflexxes.ws/">Reflexxes Type IV</a> library. In fact, Ruckig is the first Type V trajectory generator for arbitrary target states and even supports directional velocity and acceleration limits, while also being faster on top. For robotics and machining applications, Ruckig allows both instant reactions to unforeseen events as well as simple offline trajectory planning.</p>
<p>More information can be found in the corresponding paper <a href="https://arxiv.org/abs/2105.04830">Jerk-limited Real-time Trajectory Generation with Arbitrary Target States</a>, accepted for the <em>Robotics: Science and Systems (RSS), 2021</em> conference.</p>
<h2>Installation</h2>
<p>Ruckig has no dependencies (except for testing). To build Ruckig using CMake, just run</p>
<div class="fragment"><div class="line">mkdir -p build</div>
<div class="line">cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>To install Ruckig in a system-wide directory, use <code>(sudo) make install</code>. An example of using Ruckig in your CMake project is given by <code>examples/CMakeLists.txt</code>. However, you can also include Ruckig as a directory within your project and call <code>add_subdirectory(ruckig)</code> in your parent <code>CMakeLists.txt</code>.</p>
<p>Ruckig is also available as a Python module, in particular for development or debugging purposes. It can be installed from <a href="https://pypi.org/project/ruckig/">PyPI</a> via </p><div class="fragment"><div class="line">pip install ruckig</div>
</div><!-- fragment --><p>When using CMake, the Python module can be built using the <code>BUILD_PYTHON_MODULE</code> flag. If you're only interested in the Python module (and not in the C++ library), you can build and install Ruckig via <code>pip install .</code>.</p>
<h2>Tutorial</h2>
<p>Furthermore, a tutorial will explain the basics to include online generated trajectories within your application. A working example can be found in the <code>examples</code> directory. A time-optimal trajectory for a single degree of freedom is shown in the figure below.</p>
<p><img src="https://github.com/pantor/ruckig/raw/master/doc/example_profile.png?raw=true" alt="Trajectory Profile" class="inline"/></p>
<h3>Waypoint-based Trajectory Generation</h3>
<p>Ruckig provides three main interface classes: the <em>Ruckig</em>, the <em>InputParameter</em>, and the <em>OutputParameter</em> class.</p>
<p>First, you'll need to create a Ruckig instance with the number of DoFs as a template parameter, and the control cycle (e.g. in seconds) in the constructor.</p>
<div class="fragment"><div class="line">Ruckig&lt;6&gt; <a class="code" href="namespaceruckig.html">ruckig</a> {0.001}; <span class="comment">// Number DoFs; control cycle in [s]</span></div>
</div><!-- fragment --><p>The input type has 3 blocks of data: the <em>current</em> state, the <em>target</em> state and the corresponding kinematic <em>limits</em>.</p>
<div class="fragment"><div class="line">InputParameter&lt;6&gt; input; <span class="comment">// Number DoFs</span></div>
<div class="line">input.current_position = {0.2, ...};</div>
<div class="line">input.current_velocity = {0.1, ...};</div>
<div class="line">input.current_acceleration = {0.1, ...};</div>
<div class="line">input.target_position = {0.5, ...};</div>
<div class="line">input.target_velocity = {-0.1, ...};</div>
<div class="line">input.target_acceleration = {0.2, ...};</div>
<div class="line">input.max_velocity = {0.4, ...};</div>
<div class="line">input.max_acceleration = {1.0, ...};</div>
<div class="line">input.max_jerk = {4.0, ...};</div>
<div class="line"> </div>
<div class="line">OutputParameter&lt;6&gt; output; <span class="comment">// Number DoFs</span></div>
</div><!-- fragment --><p>Given all input and output resources, we can iterate over the trajectory at each discrete time step. For most applications, this loop must run within a real-time thread and controls the actual hardware.</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span> (<a class="code" href="namespaceruckig.html">ruckig</a>.update(input, output) == <a class="code" href="namespaceruckig.html#a84167d6e92f2bdcb86ce99d7aaa2d1a9a115a54563ae42ca3a24086ebcfa55247">Result::Working</a>) {</div>
<div class="line">  <span class="comment">// Make use of the new state here!</span></div>
<div class="line"> </div>
<div class="line">  input.current_position = output.new_position;</div>
<div class="line">  input.current_velocity = output.new_velocity;</div>
<div class="line">  input.current_acceleration = output.new_acceleration;</div>
<div class="line">}</div>
</div><!-- fragment --><p>During your update step, you'll need to copy the new kinematic state into the current state. If the current state is not the expected, pre-calculated trajectory, ruckig will calculate a new trajectory with the novel input. When the trajectory has reached the target state, the <code>update</code> function will return <code>Result::Finished</code>.</p>
<h3>Input Parameter</h3>
<p>To go into more detail, the <em>InputParameter</em> type has following members:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> Vector = std::array&lt;double, DOFs&gt;;</div>
<div class="line"> </div>
<div class="line">Vector current_position;</div>
<div class="line">Vector current_velocity; <span class="comment">// Initialized to zero</span></div>
<div class="line">Vector current_acceleration; <span class="comment">// Initialized to zero</span></div>
<div class="line"> </div>
<div class="line">Vector target_position;</div>
<div class="line">Vector target_velocity; <span class="comment">// Initialized to zero</span></div>
<div class="line">Vector target_acceleration; <span class="comment">// Initialized to zero</span></div>
<div class="line"> </div>
<div class="line">Vector max_velocity;</div>
<div class="line">Vector max_acceleration;</div>
<div class="line">Vector max_jerk;</div>
<div class="line"> </div>
<div class="line">std::optional&lt;Vector&gt; min_velocity; <span class="comment">// If not given, the negative maximum velocity will be used.</span></div>
<div class="line">std::optional&lt;Vector&gt; min_acceleration; <span class="comment">// If not given, the negative maximum acceleration will be used.</span></div>
<div class="line"> </div>
<div class="line">std::array&lt;bool, DOFs&gt; enabled; <span class="comment">// Initialized to true</span></div>
<div class="line">std::optional&lt;double&gt; minimum_duration;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="namespaceruckig.html#a47c13b0e731f894979621b17c63cd75c">Interface</a> interface; <span class="comment">// The default position interface controls the full kinematic state.</span></div>
<div class="line"><a class="code" href="namespaceruckig.html#a5ff5205f431128e168e1f134d117c10a">Synchronization</a> synchronization; <span class="comment">// Synchronization behavior of multiple DoFs</span></div>
<div class="line"><a class="code" href="namespaceruckig.html#a56ce59a766f7d30bd6958501127cc388">DurationDiscretization</a> duration_discretization; <span class="comment">// Whether the duration should be a discrete multiple of the control cycle (off by default)</span></div>
</div><!-- fragment --><p>Members are implemented using the C++ standard <code>array</code> and <code>optional</code> type. Note that there are range constraints due to numerical reasons, see below for more details. To check the input before a calculation step, the <code>ruckig.validate_input(input)</code> method returns <code>false</code> if an input is not valid. Of course, the target state needs to be within the given kinematic limits. Additionally, the target acceleration needs to fulfil </p><div class="fragment"><div class="line">Abs(target_acceleration) &lt;= Sqrt(2 * max_jerk * (max_velocity - Abs(target_velocity)))</div>
</div><!-- fragment --><p>If a DoF is not enabled, it will be ignored in the calculation. A minimum duration can be optionally given. Furthermore, the minimum velocity and acceleration can be specified. If it is not given, the negative maximum velocity or acceleration will be used (similar to the jerk limit). For example, this might be useful in human robot collaboration settings with a different velocity limit towards a human. Or, the dynamic limits at a given configuration of the robot can be approximated much better with different acceleration limits.</p>
<p>Furthermore, there are some options for advanced functionality, e.g.:</p><ul>
<li>for different synchronization behavior (i.a. phase or time synchonization).</li>
<li>for the control interface (position or velocity control).</li>
<li>for discrete trajectory durations.</li>
</ul>
<p>We refer to the <a href="https://pantor.github.io/ruckig/namespaceruckig.html">API documentation</a> of the enumerations within the <code>ruckig</code> namespace for all available options.</p>
<h3>Result Type</h3>
<p>The <code>update</code> function of the Ruckig class returns a Result type that indicates the current state of the algorithm. Currently, this can either be <b>working</b>, <b>finished</b> if the trajectory has finished, or an <b>error</b> type if something went wrong during calculation. The result type can be compared as a standard integer.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">State </th><th class="markdownTableHeadNone">Error Code  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Working </td><td class="markdownTableBodyNone">0  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Finished </td><td class="markdownTableBodyNone">1  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Error </td><td class="markdownTableBodyNone">-1  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ErrorInvalidInput </td><td class="markdownTableBodyNone">-100  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ErrorTrajectoryDuration </td><td class="markdownTableBodyNone">-101  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ErrorExecutionTimeCalculation </td><td class="markdownTableBodyNone">-110  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ErrorSynchronizationCalculation </td><td class="markdownTableBodyNone">-111  </td></tr>
</table>
<h3>Output Parameter</h3>
<p>The output class gives the new kinematic state of the trajectory.</p>
<div class="fragment"><div class="line">Vector <a class="code" href="namespaceposition__offline.html#a96475190f011f70210aadbac9180bd8e">new_position</a>;</div>
<div class="line">Vector <a class="code" href="namespaceposition__offline.html#a49c860e627e18ace02c52e9cc394aa8e">new_velocity</a>;</div>
<div class="line">Vector <a class="code" href="namespaceposition__offline.html#a8f687eda55e46e6a8c5e739caf3ed8ce">new_acceleration</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">bool</span> new_calculation; <span class="comment">// Whether a new calculation was performed in the last cycle</span></div>
<div class="line"><span class="keywordtype">double</span> calculation_duration; <span class="comment">// Duration of the calculation in the last cycle [µs]</span></div>
<div class="line"> </div>
<div class="line">Trajectory <a class="code" href="namespaceposition__offline.html#a2b0696fb13a5a352558936b041ce299c">trajectory</a>; <span class="comment">// The current trajectory</span></div>
<div class="line"><span class="keywordtype">double</span> time; <span class="comment">// The current, auto-incremented time. Reset to 0 at a new calculation.</span></div>
</div><!-- fragment --><p>Moreover, the trajectory class has a range of useful parameters and methods.</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> duration; <span class="comment">// Duration of the trajectory</span></div>
<div class="line">std::array&lt;double, DOFs&gt; independent_min_durations; <span class="comment">// Time-optimal profile for each independent DoF</span></div>
<div class="line"> </div>
<div class="line">&lt;...&gt; at_time(<span class="keywordtype">double</span> time); <span class="comment">// Get the kinematic state of the trajectory at a given time</span></div>
<div class="line">&lt;...&gt; get_position_extrema(); <span class="comment">// Returns information about the position extrema and their times</span></div>
</div><!-- fragment --><p>Again, we refer to the <a href="https://pantor.github.io/ruckig/">API documentation</a> for the exact signatures.</p>
<h3>Dynamical Number of Degrees of Freedom</h3>
<p>So far, we have told Ruckig the number of DoFs as a template parameter. If you don't know the number of DoFs at compile-time, you can set the template parameter to zero and pass the DoFs to the constructor:</p>
<div class="fragment"><div class="line">Ruckig&lt;0&gt; otg {6, 0.001};</div>
<div class="line">InputParameter&lt;0&gt; input {6};</div>
<div class="line">OutputParameter&lt;0&gt; output {6};</div>
</div><!-- fragment --><p>However, we recommend to keep the template parameter when possible: First, it has a performance benefit of a few percent. Second, it is convenient for real-time programming due to its easier handling of memory allocations. When using dynamic degrees of freedom, make sure to allocate the memory of all vectors beforehand.</p>
<h2>Tests and Numerical Stability</h2>
<p>The current test suite validates over 5.000.000.000 random trajectories. The numerical exactness is tested for the final position and final velocity to be within <code>1e-8</code>, for the velocity, acceleration and jerk limit to be within <code>1e-12</code>, and for the final acceleration as well to be within a numerical error of <code>1e-12</code>. The maximal supported trajectory duration is <code>7e3</code>, which sounds short but should suffice for most applications seeking for time-optimality. Note that Ruckig will also output values outside of this range, there is however no guarantee for correctness.</p>
<h2>Benchmark</h2>
<p>We find that Ruckig is more than twice as fast as Reflexxes Type IV and well-suited for control cycles as low as half a millisecond.</p>
<p><img src="https://github.com/pantor/ruckig/raw/master/doc/benchmark.png?raw=true" alt="Benchmark" class="inline"/></p>
<h2>Development</h2>
<p>Ruckig is written in C++17. It is continuously tested on <code>ubuntu-latest</code>, <code>macos-latest</code>, and <code>windows-latest</code> against following versions</p>
<ul>
<li>Doctest v2.4 (only for testing)</li>
<li>Pybind11 v2.6 (only for python wrapper)</li>
</ul>
<p>If you still need to use C++11, you can patch Ruckig by calling <code>sh patch-c++11.sh</code>. Note that this will result in a performance drop of a few percent. Moreover, the Python module is not supported.</p>
<h2>Citation</h2>
<div class="fragment"><div class="line">@article{berscheid2021jerk,</div>
<div class="line">  title={Jerk-limited Real-time Trajectory Generation with Arbitrary Target States},</div>
<div class="line">  author={Berscheid, Lars and Kr{\&quot;o}ger, Torsten},</div>
<div class="line">  journal={Robotics: Science and Systems XVII},</div>
<div class="line">  year={2021}</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<div class="ttc" id="anamespaceruckig_html_a84167d6e92f2bdcb86ce99d7aaa2d1a9a115a54563ae42ca3a24086ebcfa55247"><div class="ttname"><a href="namespaceruckig.html#a84167d6e92f2bdcb86ce99d7aaa2d1a9a115a54563ae42ca3a24086ebcfa55247">ruckig::Working</a></div><div class="ttdeci">@ Working</div><div class="ttdoc">The trajectory is calculated normally.</div><div class="ttdef"><b>Definition:</b> input_parameter.hpp:15</div></div>
<div class="ttc" id="anamespaceruckig_html"><div class="ttname"><a href="namespaceruckig.html">ruckig</a></div><div class="ttdef"><b>Definition:</b> block.hpp:11</div></div>
<div class="ttc" id="anamespaceruckig_html_a56ce59a766f7d30bd6958501127cc388"><div class="ttname"><a href="namespaceruckig.html#a56ce59a766f7d30bd6958501127cc388">ruckig::DurationDiscretization</a></div><div class="ttdeci">DurationDiscretization</div><div class="ttdef"><b>Definition:</b> input_parameter.hpp:37</div></div>
<div class="ttc" id="anamespaceposition__offline_html_a8f687eda55e46e6a8c5e739caf3ed8ce"><div class="ttname"><a href="namespaceposition__offline.html#a8f687eda55e46e6a8c5e739caf3ed8ce">position_offline.new_acceleration</a></div><div class="ttdeci">new_acceleration</div><div class="ttdef"><b>Definition:</b> position_offline.py:38</div></div>
<div class="ttc" id="anamespaceposition__offline_html_a96475190f011f70210aadbac9180bd8e"><div class="ttname"><a href="namespaceposition__offline.html#a96475190f011f70210aadbac9180bd8e">position_offline.new_position</a></div><div class="ttdeci">new_position</div><div class="ttdef"><b>Definition:</b> position_offline.py:38</div></div>
<div class="ttc" id="anamespaceruckig_html_a47c13b0e731f894979621b17c63cd75c"><div class="ttname"><a href="namespaceruckig.html#a47c13b0e731f894979621b17c63cd75c">ruckig::Interface</a></div><div class="ttdeci">Interface</div><div class="ttdef"><b>Definition:</b> input_parameter.hpp:25</div></div>
<div class="ttc" id="anamespaceruckig_html_a5ff5205f431128e168e1f134d117c10a"><div class="ttname"><a href="namespaceruckig.html#a5ff5205f431128e168e1f134d117c10a">ruckig::Synchronization</a></div><div class="ttdeci">Synchronization</div><div class="ttdef"><b>Definition:</b> input_parameter.hpp:30</div></div>
<div class="ttc" id="anamespaceposition__offline_html_a2b0696fb13a5a352558936b041ce299c"><div class="ttname"><a href="namespaceposition__offline.html#a2b0696fb13a5a352558936b041ce299c">position_offline.trajectory</a></div><div class="ttdeci">trajectory</div><div class="ttdef"><b>Definition:</b> position_offline.py:26</div></div>
<div class="ttc" id="anamespaceposition__offline_html_a49c860e627e18ace02c52e9cc394aa8e"><div class="ttname"><a href="namespaceposition__offline.html#a49c860e627e18ace02c52e9cc394aa8e">position_offline.new_velocity</a></div><div class="ttdeci">new_velocity</div><div class="ttdef"><b>Definition:</b> position_offline.py:38</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
